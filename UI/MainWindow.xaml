<Window x:Class="UI.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:oxy="http://oxyplot.org/wpf"
        xmlns:conv="clr-namespace:UI.Converters"
        mc:Ignorable="d"
        Title="Simulation" Width="1200" Height="800"
        Language="en-US">

    <Window.Resources>
        <Color x:Key="BgColor">#0F141A</Color>
        <Color x:Key="PanelColor">#121821</Color>
        <Color x:Key="CardColor">#161D28</Color>
        <Color x:Key="BorderColor">#24303F</Color>
        <Color x:Key="TextColor">#E9EEF4</Color>
        <Color x:Key="SubtleTextColor">#A9B4C2</Color>

        <Color x:Key="AccentColor">#FFA500</Color>
        <Color x:Key="AccentHoverColor">#FFB733</Color>
        <Color x:Key="AccentPressedColor">#E09000</Color>

        <Color x:Key="InputBgColor">#101720</Color>
        <Color x:Key="InputBorderColor">#2A384B</Color>
        <Color x:Key="InputFocusColor">#FFA500</Color>

        <SolidColorBrush x:Key="BgBrush" Color="{StaticResource BgColor}"/>
        <SolidColorBrush x:Key="PanelBrush" Color="{StaticResource PanelColor}"/>
        <SolidColorBrush x:Key="CardBrush" Color="{StaticResource CardColor}"/>
        <SolidColorBrush x:Key="BorderBrushColor" Color="{StaticResource BorderColor}"/>
        <SolidColorBrush x:Key="TextBrush" Color="{StaticResource TextColor}"/>
        <SolidColorBrush x:Key="SubtleTextBrush" Color="{StaticResource SubtleTextColor}"/>

        <SolidColorBrush x:Key="AccentBrush" Color="{StaticResource AccentColor}"/>
        <SolidColorBrush x:Key="AccentHoverBrush" Color="{StaticResource AccentHoverColor}"/>
        <SolidColorBrush x:Key="AccentPressedBrush" Color="{StaticResource AccentPressedColor}"/>

        <SolidColorBrush x:Key="InputBgBrush" Color="{StaticResource InputBgColor}"/>
        <SolidColorBrush x:Key="InputBorderBrush" Color="{StaticResource InputBorderColor}"/>
        <SolidColorBrush x:Key="InputFocusBrush" Color="{StaticResource InputFocusColor}"/>

        <Style TargetType="Window">
            <Setter Property="Background" Value="{StaticResource BgBrush}"/>
            <Setter Property="Foreground" Value="{StaticResource TextBrush}"/>
        </Style>

        <Style TargetType="TextBlock">
            <Setter Property="Foreground" Value="{StaticResource TextBrush}"/>
        </Style>

        <Style TargetType="Label">
            <Setter Property="Foreground" Value="{StaticResource SubtleTextBrush}"/>
            <Setter Property="Margin" Value="0,6,0,0"/>
        </Style>

        <Style TargetType="TextBox">
            <Setter Property="Margin" Value="0,4"/>
            <Setter Property="HorizontalAlignment" Value="Stretch"/>
            <Setter Property="Background" Value="{StaticResource InputBgBrush}"/>
            <Setter Property="BorderBrush" Value="{StaticResource InputBorderBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="8,6"/>
            <Setter Property="Foreground" Value="{StaticResource TextBrush}"/>
            <Setter Property="SnapsToDevicePixels" Value="True"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Border x:Name="bd"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="8">
                            <ScrollViewer x:Name="PART_ContentHost"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsKeyboardFocused" Value="True">
                                <Setter TargetName="bd" Property="BorderBrush" Value="{StaticResource InputFocusBrush}"/>
                                <Setter TargetName="bd" Property="BorderThickness" Value="1.5"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="bd" Property="Opacity" Value="0.6"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style TargetType="Button">
            <Setter Property="Foreground" Value="#0B0B0B"/>
            <Setter Property="Background" Value="{StaticResource AccentBrush}"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="bd"
                                Background="{TemplateBinding Background}"
                                CornerRadius="10"
                                SnapsToDevicePixels="True">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"
                                              RecognizesAccessKey="True"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="bd" Property="Background" Value="{StaticResource AccentHoverBrush}"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="bd" Property="Background" Value="{StaticResource AccentPressedBrush}"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="bd" Property="Opacity" Value="0.5"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="SecondaryButton" TargetType="Button" BasedOn="{StaticResource {x:Type Button}}">
            <Setter Property="Background" Value="{StaticResource CardBrush}"/>
            <Setter Property="Foreground" Value="{StaticResource TextBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderBrushColor}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="bd"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="10">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="bd" Property="BorderBrush" Value="{StaticResource AccentBrush}"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="bd" Property="Background" Value="#0F141A"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="bd" Property="Opacity" Value="0.5"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style TargetType="TabControl">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="8"/>
            <Setter Property="Foreground" Value="{StaticResource TextBrush}"/>
        </Style>

        <Style x:Key="ChartTabItemStyle" TargetType="TabItem">
            <Setter Property="Margin" Value="0,0,0,0"/>
            <Setter Property="Foreground" Value="{StaticResource SubtleTextBrush}"/>
            <Setter Property="Padding" Value="10"/>
            <Setter Property="ContentTemplate">
                <Setter.Value>
                    <DataTemplate>
                        <Border Background="{StaticResource CardBrush}"
                                BorderBrush="{StaticResource BorderBrushColor}"
                                BorderThickness="1"
                                CornerRadius="12"
                                Padding="16"
                                Margin="12">
                            <ContentPresenter Content="{Binding}" ContentTemplate="{x:Null}"/>
                        </Border>
                    </DataTemplate>
                </Setter.Value>
            </Setter>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TabItem">
                        <Border x:Name="HeaderBd"
                                Background="{StaticResource PanelBrush}"
                                BorderBrush="{StaticResource BorderBrushColor}"
                                BorderThickness="1"
                                CornerRadius="10"
                                Padding="10,6"
                                Margin="0,0,8,8">
                            <ContentPresenter ContentSource="Header"
                                              VerticalAlignment="Center"
                                              HorizontalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="HeaderBd" Property="BorderBrush" Value="{StaticResource AccentBrush}"/>
                                <Setter Property="Foreground" Value="{StaticResource TextBrush}"/>
                            </Trigger>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="HeaderBd" Property="Background" Value="{StaticResource CardBrush}"/>
                                <Setter TargetName="HeaderBd" Property="BorderBrush" Value="{StaticResource AccentBrush}"/>
                                <Setter Property="Foreground" Value="{StaticResource TextBrush}"/>
                                <Setter TargetName="HeaderBd" Property="Padding" Value="12,8"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="HeaderBd" Property="Opacity" Value="0.5"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <conv:DoubleInvariantConverter x:Key="DoubleInv"/>
    </Window.Resources>

    <Grid Background="{StaticResource BgBrush}">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="320"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <Border Grid.Column="0"
                Padding="12"
                Background="{StaticResource PanelBrush}"
                BorderBrush="{StaticResource BorderBrushColor}"
                BorderThickness="1">
            <StackPanel>
                <Border Background="{StaticResource CardBrush}"
                        CornerRadius="10"
                        Padding="10"
                        Margin="0,0,0,12"
                        BorderBrush="{StaticResource BorderBrushColor}"
                        BorderThickness="1">
                    <TextBlock Text="Параметры симуляции" FontWeight="Bold" FontSize="16"/>
                </Border>

                <Label Content="tEnd (с)"/>
                <TextBox Text="{Binding TEnd, Converter={StaticResource DoubleInv}, UpdateSourceTrigger=PropertyChanged}"/>

                <Label Content="dt (с)"/>
                <TextBox Text="{Binding Dt, Converter={StaticResource DoubleInv}, UpdateSourceTrigger=PropertyChanged}"/>

                <Label Content="tStartDropping (с)"/>
                <TextBox Text="{Binding TStartDropping, Converter={StaticResource DoubleInv}, UpdateSourceTrigger=PropertyChanged}"/>

                <Label Content="Hset (м)"/>
                <TextBox Text="{Binding HSet, Converter={StaticResource DoubleInv}, UpdateSourceTrigger=PropertyChanged}"/>

                <Label Content="LawNum"/>
                <TextBox Text="{Binding LawNum, UpdateSourceTrigger=PropertyChanged}"/>

                <Label Content="aCargo"/>
                <TextBox Text="{Binding ACargo, Converter={StaticResource DoubleInv}, UpdateSourceTrigger=PropertyChanged}"/>

                <Label Content="lCabin"/>
                <TextBox Text="{Binding LCabin, Converter={StaticResource DoubleInv}, UpdateSourceTrigger=PropertyChanged}"/>

                <StackPanel Orientation="Horizontal" Margin="0,12,0,0">
                    <Button Content="Запустить" Command="{Binding RunCommand}" Padding="12,6"/>
                    <Button Content="Обновить графики"
                            Command="{Binding RefreshAllCommand}"
                            Padding="12,6"
                            Margin="8,0,0,0"
                            Style="{StaticResource SecondaryButton}"/>
                </StackPanel>
            </StackPanel>
        </Border>

        <TabControl Grid.Column="1"
                    Margin="16"
                    Padding="8"
                    ItemContainerStyle="{StaticResource ChartTabItemStyle}">
            <TabItem Header="H(t)">
                <oxy:PlotView Model="{Binding HeightPlot}"/>
            </TabItem>
            <TabItem Header="δv(t)">
                <oxy:PlotView Model="{Binding DvPlot}"/>
            </TabItem>
            <TabItem Header="α(t)">
                <oxy:PlotView Model="{Binding AlphaPlot}"/>
            </TabItem>
            <TabItem Header="θ(t)">
                <oxy:PlotView Model="{Binding ThetaPlot}"/>
            </TabItem>
            <TabItem Header="αбал(t)">
                <oxy:PlotView Model="{Binding AlphaBal}"/>
            </TabItem>
            <TabItem Header="δvбал(t)">
                <oxy:PlotView Model="{Binding DeltaVBal}"/>
            </TabItem>
        </TabControl>
    </Grid>
</Window>
